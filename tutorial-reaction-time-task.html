<!DOCTYPE html>

<!-- Tutorial link: https://www.jspsych.org/tutorials/rt-task/ -->

<html>
	<head>
		<title>Reaction Time Task Tutorial</title>
		<script src="jspsych-6.3.1/jspsych.js"></script>   <!--LOAD THE JSPSYCH LIBRARY-->
		<script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script> <!--load a keyboard response plugin-->
		<script src="jspsych-6.3.1/plugins/jspsych-image-keyboard-response.js"></script> <!--load an image response plugin-->
		<script src="jspsych-6.3.1/plugins/jspsych-preload.js"></script> <!--load the plugin for preloading media-->
		<link href="jspsych-6.3.1/css/jspsych.css" rel="stylesheet" type="text/css">   <!--LOAD THE JSPSYCH CSS STYLESHEET-->
	</head>
	
	<body></body>
	
	<!--JSPSYCH SCRIPT-->
	<script>
		
		/* create the timeline variable (array) */
		var timeline = [];
		
		
		/* preload media (before any other trials begin) */
		var preload = {
			type: 'preload',
			images: ['img/blue.png', 'img/orange.png']
		};
		
		timeline.push(preload);
		
		
		/* create a 'welcome' trial */
		var welcome = {
			type: "html-keyboard-response",
			stimulus: "Press any key to begin."
		};
		
		timeline.push(welcome); /* push the 'welcome' trial into the timeline (append to the end of the array) */
		
		
		/* define instructions (use backticks (under tilde key) for multiline strings: ``) */
		var instructions = {
			type: "html-keyboard-response",
			stimulus: `
			<p>These are the instructions. You can use <strong>html</strong> to format this text. 
			In this experiment, a circle will appear in the center of the screen.</p><p>If the circle is <strong>blue</strong>, 
			press the letter F on the keyboard as fast as you can.</p>
			<p>If the circle is <strong>orange</strong>, press the letter J as fast as you can.</p>
			<div style='width: 700px;'>
			<div style='float: left;'><img src='img/blue.png'></img>
			<p class='small'><strong>Press the F key</strong></p></div>
			<div class='float: right;'><img src='img/orange.png'></img>
			<p class='small'><strong>Press the J key</strong></p></div>
			</div>
			<p>Press any key to begin.</p>
			`,
			post_trial_gap: 2000   /* add a 2 second gap after this trial*/
		};
		
		timeline.push(instructions);
		
		
		/* create an array defining stimuli */
		var test_stimuli = [
			{ stimulus: "img/blue.png", correct_response: 'f' },  /* also specify which key represents the correct response */
			{ stimulus: "img/orange.png", correct_response: 'j' }
		];
		
		
		/* set up fixation cross */
		var fixation = {
			type: 'html-keyboard-response',
			stimulus: '<div style="font-size:60px;">+</div>',
			choices: jsPsych.NO_KEYS,   /* no key response accepted */
			/*trial_duration: 1000,      sets duration to 1 second but you can also vary the duration time with the function below */
			trial_duration: function(){
				return jsPsych.randomization.sampleWithoutReplacement([250, 500, 750, 1000], 1)[0];
			},
			data: {
				task: 'fixation',   /* label this trial as 'fixation' in the data */
			}
		};
		
		
		/* define test trial */
		var test = {
			type: "image-keyboard-response",
			stimulus: jsPsych.timelineVariable('stimulus'),  /* displays the stimulus as defined in 'test_stimuli' */
			choices: ['f', 'j'],
			data: {
				task: 'response',  /* tag each 'test' trial as 'response'*/
				correct_response: jsPsych.timelineVariable('correct_response'), /* add the correct r from 'test_stimuli' to our data*/
			},
			on_finish: function(data){    /* create a new 'correct' variable that computes if the key pressed was the correct one */
				data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
			},
		};
		
		
		/* create a new timeline for the fixation + test trial sequence */
		var test_procedure = {
			timeline: [fixation, test],
			timeline_variables: test_stimuli,  /* links 'test_stimuli' with 'test' */
			randomize_order: true,    /* displays stimuli in random order */
			repetitions: 2     /* loop through the stimuli array 2 times (i.e. 4 trials in our case) */
		};
		timeline.push(test_procedure)  /* push this new timeline to the main timeline */
		
		
		/* set up debriefing */
		var debrief_block = {
			type: "html-keyboard-response",
			stimulus: function(){
				
				var trials = jsPsych.data.get().filter({task: 'response'});  /* select response trials */
				var correct_trials = trials.filter({correct: true});        /* select only correct response trials */
				var accuracy = Math.round(correct_trials.count() / trials.count() * 100);  /* calc accuracy using the above variables */
				var rt = Math.round(correct_trials.select('rt').mean());   /* calculate mean response time */
				
				return `<p>You responded correctly on ${accuracy}% of the trials.</p>
				<p>Your average response time was ${rt}ms.</p>
				<p>Press any key to complete the experiment. Thank you!</p>
				`;
				
			}
		};
		
		timeline.push(debrief_block);
		
	
		/* initialize the experiment */
		jsPsych.init({
			timeline: timeline,
			on_finish: function() {             /* show data at the end of the experiment, for debugging*/
				jsPsych.data.displayData();
			}
		});
			
	</script>	
</html>